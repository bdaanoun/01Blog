<div class="post-detail-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
    <button routerLink="/home" class="back-btn">Back to Home</button>
  </div>

  <!-- Post Content -->
  <article *ngIf="!loading && !error && post" class="post-article">
    <!-- Post Header -->
    <header class="post-header">
      <h1 class="post-title">{{ post.title }}</h1>

      <div class="post-meta">
        <div class="author-info">
          <div class="author-avatar">
            {{ getAuthorInitial(post.authorName) }}
          </div>
          <div class="author-details">
            <span class="author-name">{{ post.authorName || 'Unknown' }}</span>
            <div class="meta-info">
              <span>{{ getTimeAgo(post.createdAt) }}</span>
              <span class="separator">Â·</span>
              <span>{{ getReadTime(post.content) }} min read</span>
            </div>
          </div>
        </div>

        <div class="post-actions">
          <button class="like-button" [class.liked]="post.likedByCurrentUser" (click)="toggleLike()"
            [attr.aria-label]="post.likedByCurrentUser ? 'Unlike' : 'Like'">
            <svg width="24" height="24" viewBox="0 0 24 24"
              [attr.fill]="post.likedByCurrentUser ? 'currentColor' : 'none'" stroke="currentColor" stroke-width="2">
              <path
                d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
            </svg>
            <span *ngIf="post.likesCount > 0">{{ post.likesCount }}</span>
          </button>
        </div>
      </div>
    </header>

    <!-- Banner Image -->
    <div class="post-banner" *ngIf="post.banner">
      <img [src]="getBannerUrl(post.banner)" [alt]="post.title">
    </div>

    <!-- Post Content (EditorJS Blocks) -->
    <div class="post-content">
      <div *ngFor="let block of renderedContent" class="content-block">
        <!-- Paragraph -->
        <p *ngIf="block.type === 'paragraph'" class="paragraph" [innerHTML]="getSafeHtml(block.data.text)"></p>

        <!-- Header -->
        <h2 *ngIf="block.type === 'header' && block.data.level === 2" class="heading-2"
          [innerHTML]="getSafeHtml(block.data.text)"></h2>
        <h3 *ngIf="block.type === 'header' && block.data.level === 3" class="heading-3"
          [innerHTML]="getSafeHtml(block.data.text)"></h3>

        <!-- List -->
        <ul *ngIf="block.type === 'list' && block.data.style === 'unordered'" class="list">
          <li *ngFor="let item of block.data.items" [innerHTML]="getSafeHtml(item.content)"></li>
        </ul>
        <ol *ngIf="block.type === 'list' && block.data.style === 'ordered'" class="list">
          <li *ngFor="let item of block.data.items" [innerHTML]="getSafeHtml(item)"></li>
        </ol>
        <!-- Checklist -->
        <ul *ngIf="block.type === 'list' && block.data.style === 'checklist'" class="checklist">
          <li *ngFor="let item of block.data.items" class="checklist-item">
            <input type="checkbox" [checked]="item.meta?.checked" disabled />

            <span [class.checked]="item.meta?.checked" [innerHTML]="getSafeHtml(item.content)"></span>
          </li>
        </ul>



        <!-- Image -->
        <figure *ngIf="block.type === 'image'" class="image-block">
          <img [src]="block.data.file?.url || block.data.url" [alt]="block.data.caption || ''">
          <figcaption *ngIf="block.data.caption" [innerHTML]="getSafeHtml(block.data.caption)"></figcaption>
        </figure>
      </div>
    </div>

    <!-- Back Button -->
    <div class="post-footer">
      <button routerLink="/home" class="back-link">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
        Back to Stories
      </button>
    </div>
  </article>
</div>